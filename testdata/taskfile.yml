# Taskfile.yml with go install commands
# https://taskfile.dev

version: '3'

tasks:
  install-tools:
    desc: Install development tools
    cmds:
      - go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
      - go install golang.org/x/tools/cmd/goimports@latest
      - go install honnef.co/go/tools/cmd/staticcheck@latest

  lint:
    desc: Run linter
    deps: [install-tools]
    cmds:
      - golangci-lint run

  test:
    desc: Run tests
    cmds:
      - go install gotest.tools/gotestsum@latest
      - gotestsum --format testname

  generate:
    desc: Generate code
    cmds:
      - go install golang.org/x/tools/cmd/stringer@latest
      - go install github.com/golang/mock/mockgen@latest
      - go generate ./...

  security:
    desc: Security scanning
    cmds:
      - go install github.com/securego/gosec/v2/cmd/gosec@latest
      - gosec ./...
      - go install golang.org/x/vuln/cmd/govulncheck@v1.0.0
      - govulncheck ./...

  dev:
    desc: Start development server
    cmds:
      - go install github.com/cosmtrek/air@latest
      - air

  build:
    desc: Build with goreleaser
    cmds:
      - go install -v github.com/goreleaser/goreleaser@latest
      - goreleaser build --snapshot --clean
